<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | 上校的玩具间</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="坐而言不如起而行。js,java,vue,Spring,html5,Node,git,github,CodeQL等技术文章。">
    
    <link rel="preload" href="/assets/css/0.styles.55d26f3f.css" as="style"><link rel="preload" href="/assets/js/app.cc096181.js" as="script"><link rel="preload" href="/assets/js/2.5dee0ed7.js" as="script"><link rel="preload" href="/assets/js/27.833d6eeb.js" as="script"><link rel="prefetch" href="/assets/js/10.c62e6ba0.js"><link rel="prefetch" href="/assets/js/11.a2442b49.js"><link rel="prefetch" href="/assets/js/12.08da015b.js"><link rel="prefetch" href="/assets/js/13.c990750d.js"><link rel="prefetch" href="/assets/js/14.caf4037b.js"><link rel="prefetch" href="/assets/js/15.052ffcdb.js"><link rel="prefetch" href="/assets/js/16.601483d2.js"><link rel="prefetch" href="/assets/js/17.78753bd0.js"><link rel="prefetch" href="/assets/js/18.8265a3db.js"><link rel="prefetch" href="/assets/js/19.c71deec5.js"><link rel="prefetch" href="/assets/js/20.3dc6ddb8.js"><link rel="prefetch" href="/assets/js/21.18547e0f.js"><link rel="prefetch" href="/assets/js/22.a3431622.js"><link rel="prefetch" href="/assets/js/23.91fc9bba.js"><link rel="prefetch" href="/assets/js/24.e18e54c5.js"><link rel="prefetch" href="/assets/js/25.776bb8aa.js"><link rel="prefetch" href="/assets/js/26.89a4c751.js"><link rel="prefetch" href="/assets/js/28.7705d981.js"><link rel="prefetch" href="/assets/js/29.a043ebe1.js"><link rel="prefetch" href="/assets/js/3.949795aa.js"><link rel="prefetch" href="/assets/js/30.68a4dd93.js"><link rel="prefetch" href="/assets/js/31.0e5c8b84.js"><link rel="prefetch" href="/assets/js/32.fac4fa2c.js"><link rel="prefetch" href="/assets/js/33.8427560a.js"><link rel="prefetch" href="/assets/js/34.fc07cf5a.js"><link rel="prefetch" href="/assets/js/35.79ddcc93.js"><link rel="prefetch" href="/assets/js/36.e9e31113.js"><link rel="prefetch" href="/assets/js/37.7376d7c9.js"><link rel="prefetch" href="/assets/js/38.67d4abcf.js"><link rel="prefetch" href="/assets/js/39.287d22c4.js"><link rel="prefetch" href="/assets/js/4.362b37b2.js"><link rel="prefetch" href="/assets/js/40.5144274a.js"><link rel="prefetch" href="/assets/js/41.a055f9e8.js"><link rel="prefetch" href="/assets/js/42.1a857a3b.js"><link rel="prefetch" href="/assets/js/43.4c4532d1.js"><link rel="prefetch" href="/assets/js/44.9768cf32.js"><link rel="prefetch" href="/assets/js/45.31810108.js"><link rel="prefetch" href="/assets/js/46.d5c9957a.js"><link rel="prefetch" href="/assets/js/47.8503638e.js"><link rel="prefetch" href="/assets/js/48.89c8fe11.js"><link rel="prefetch" href="/assets/js/49.8e42420e.js"><link rel="prefetch" href="/assets/js/5.9a721ad4.js"><link rel="prefetch" href="/assets/js/50.2c59a9d3.js"><link rel="prefetch" href="/assets/js/51.4e8c6245.js"><link rel="prefetch" href="/assets/js/52.4bdda958.js"><link rel="prefetch" href="/assets/js/53.f4d3ebb7.js"><link rel="prefetch" href="/assets/js/54.8c9ef8ef.js"><link rel="prefetch" href="/assets/js/55.55e9ad2d.js"><link rel="prefetch" href="/assets/js/56.f3bb01b2.js"><link rel="prefetch" href="/assets/js/57.974fc40b.js"><link rel="prefetch" href="/assets/js/58.cceff5ff.js"><link rel="prefetch" href="/assets/js/59.17316a40.js"><link rel="prefetch" href="/assets/js/6.ec7467fe.js"><link rel="prefetch" href="/assets/js/60.d52cb7bf.js"><link rel="prefetch" href="/assets/js/61.4f998d76.js"><link rel="prefetch" href="/assets/js/62.4090d670.js"><link rel="prefetch" href="/assets/js/63.ae02f421.js"><link rel="prefetch" href="/assets/js/64.67620b73.js"><link rel="prefetch" href="/assets/js/65.a7664222.js"><link rel="prefetch" href="/assets/js/66.68203f8e.js"><link rel="prefetch" href="/assets/js/67.24a623b2.js"><link rel="prefetch" href="/assets/js/68.0eb87a07.js"><link rel="prefetch" href="/assets/js/69.cc0a2061.js"><link rel="prefetch" href="/assets/js/7.79257635.js"><link rel="prefetch" href="/assets/js/70.99ed2497.js"><link rel="prefetch" href="/assets/js/71.a0cb4c42.js"><link rel="prefetch" href="/assets/js/8.d2115d3f.js"><link rel="prefetch" href="/assets/js/9.67223949.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55d26f3f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/logo.png" alt="上校的玩具间" class="logo"> <span class="site-name can-hide">上校的玩具间</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev/" class="link-title router-link-active">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev/web/" class="nav-link">前端目录</a></li><li class="dropdown-subitem"><a href="/dev/web/basis/htmlandcss/" class="nav-link">HTML/CSS基础</a></li></ul></li><li class="dropdown-item"><h4>后端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev/java/" class="nav-link router-link-active">Java后端</a></li><li class="dropdown-subitem"><a href="/dev/java/core/spring5/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/dev/java/core/mybatis/" class="nav-link">Mybatis</a></li><li class="dropdown-subitem"><a href="/dev/java/core/springmvc/" class="nav-link">SpringMVC</a></li><li class="dropdown-subitem"><a href="/dev/java/core/springbootbase/" class="nav-link">Springboot基础篇</a></li><li class="dropdown-subitem"><a href="/dev/java/eco/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Docker</a></li></ul></li><li class="dropdown-item"><!----> <a href="/dev/basic/" class="nav-link">计算机基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安全" class="dropdown-title"><a href="/sec/" class="link-title">安全</a> <span class="title" style="display:none;">安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sec/sa/" class="nav-link">静态分析</a></li><li class="dropdown-item"><!----> <a href="/sec/vuln/" class="nav-link">漏洞原理</a></li><li class="dropdown-item"><!----> <a href="/sec/dev/" class="nav-link">安全开发</a></li></ul></div></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">站点导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li><li class="dropdown-item"><!----> <a href="/more/blog/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><a href="https://travellings.link/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Travelling
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/avatar.jpg"> <div class="blogger-info"><h3>p0jo</h3> <span>欲变世界，先变自己。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev/" class="link-title router-link-active">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev/web/" class="nav-link">前端目录</a></li><li class="dropdown-subitem"><a href="/dev/web/basis/htmlandcss/" class="nav-link">HTML/CSS基础</a></li></ul></li><li class="dropdown-item"><h4>后端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev/java/" class="nav-link router-link-active">Java后端</a></li><li class="dropdown-subitem"><a href="/dev/java/core/spring5/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/dev/java/core/mybatis/" class="nav-link">Mybatis</a></li><li class="dropdown-subitem"><a href="/dev/java/core/springmvc/" class="nav-link">SpringMVC</a></li><li class="dropdown-subitem"><a href="/dev/java/core/springbootbase/" class="nav-link">Springboot基础篇</a></li><li class="dropdown-subitem"><a href="/dev/java/eco/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Docker</a></li></ul></li><li class="dropdown-item"><!----> <a href="/dev/basic/" class="nav-link">计算机基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安全" class="dropdown-title"><a href="/sec/" class="link-title">安全</a> <span class="title" style="display:none;">安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sec/sa/" class="nav-link">静态分析</a></li><li class="dropdown-item"><!----> <a href="/sec/vuln/" class="nav-link">漏洞原理</a></li><li class="dropdown-item"><!----> <a href="/sec/dev/" class="nav-link">安全开发</a></li></ul></div></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">站点导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li><li class="dropdown-item"><!----> <a href="/more/blog/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><a href="https://travellings.link/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Travelling
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>后端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>微服务核心</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>微服务生态</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/java/eco/docker/" aria-current="page" class="active sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#docker-理念" class="sidebar-link">Docker 理念</a></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#linux容器的实现方式" class="sidebar-link">Linux容器的实现方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#namespace" class="sidebar-link">NameSpace</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#cgroups" class="sidebar-link">Cgroups</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#chroot" class="sidebar-link">Chroot</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#docker和虚拟机的区别" class="sidebar-link">Docker和虚拟机的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#虚拟机" class="sidebar-link">虚拟机</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-2" class="sidebar-link">Docker</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#docker的优势" class="sidebar-link">Docker的优势</a></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#相关概念" class="sidebar-link">相关概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#镜像" class="sidebar-link">镜像</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#容器" class="sidebar-link">容器</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#仓库" class="sidebar-link">仓库</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#centos安装docker" class="sidebar-link">Centos安装Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_1-卸载旧版本docker" class="sidebar-link">1. 卸载旧版本Docker</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_2-设置镜像仓库" class="sidebar-link">2. 设置镜像仓库</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_3-安装docker" class="sidebar-link">3. 安装Docker</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_4-配置镜像加速" class="sidebar-link">4. 配置镜像加速</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_5-启动docker并测试" class="sidebar-link">5. 启动Docker并测试</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_6-docker-run逻辑图" class="sidebar-link">6. Docker Run逻辑图</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_99-卸载方式" class="sidebar-link">99. 卸载方式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#docker-常用命令" class="sidebar-link">Docker 常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#帮助相关" class="sidebar-link">帮助相关</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#镜像相关命令" class="sidebar-link">镜像相关命令</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#容器相关命令" class="sidebar-link">容器相关命令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#镜像-2" class="sidebar-link">镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#unionfs-联合文件系统" class="sidebar-link">UnionFS - 联合文件系统</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker镜像加载原理" class="sidebar-link">Docker镜像加载原理</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-commit" class="sidebar-link">Docker commit</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#容器数据卷" class="sidebar-link">容器数据卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#命令行创建容器数据卷" class="sidebar-link">命令行创建容器数据卷</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#dockerfile创建容器数据卷" class="sidebar-link">Dockerfile创建容器数据卷</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#数据卷容器" class="sidebar-link">数据卷容器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#docker安装常见的服务" class="sidebar-link">Docker安装常见的服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-安装-mysql" class="sidebar-link">Docker 安装 Mysql</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker安装redis" class="sidebar-link">Docker安装Redis</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-安装-nginx" class="sidebar-link">Docker 安装 nginx</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-安装-tomcat" class="sidebar-link">Docker 安装 Tomcat</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-安装-es" class="sidebar-link">Docker 安装 ES</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-常见问题处置" class="sidebar-link">Docker 常见问题处置</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#dockerfile" class="sidebar-link">Dockerfile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#什么是dockerfile" class="sidebar-link">什么是Dockerfile</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#dockerfile解析过程" class="sidebar-link">Dockerfile解析过程</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#dockerfile的保留命令" class="sidebar-link">Dockerfile的保留命令</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#dockerfile-打包-springboot项目" class="sidebar-link">Dockerfile 打包 Springboot项目</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#本地镜像发布" class="sidebar-link">本地镜像发布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_2-从registry中拉取镜像" class="sidebar-link">2. 从Registry中拉取镜像</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_3-将镜像推送到registry" class="sidebar-link">3. 将镜像推送到Registry</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_4-选择合适的镜像仓库地址" class="sidebar-link">4. 选择合适的镜像仓库地址</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#_5-示例" class="sidebar-link">5. 示例</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#高级网络和容器卷" class="sidebar-link">高级网络和容器卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#高级网络配置" class="sidebar-link">高级网络配置</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#高级数据卷配置" class="sidebar-link">高级数据卷配置</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#docker-compose" class="sidebar-link">Docker compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-compose使用" class="sidebar-link">docker compose使用</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-compose-模板文件" class="sidebar-link">docker-compose 模板文件</a></li><li class="sidebar-sub-header level3"><a href="/dev/java/eco/docker/#docker-compose-常用命令" class="sidebar-link">docker-compose 常用命令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/dev/java/eco/docker/#docker可视化工具" class="sidebar-link">docker可视化工具</a></li></ul></li><li><a href="/dev/java/eco/springsecurity/" class="sidebar-link">Spring Security</a></li><li><a href="/dev/java/eco/shiro/" class="sidebar-link">Shiro</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>项目实战</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/dev/#开发" data-v-06225672>开发</a></li><li data-v-06225672><a href="/dev/#后端" data-v-06225672>后端</a></li><li data-v-06225672><a href="/dev/#微服务生态" data-v-06225672>微服务生态</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://wiki.pwddd.com" target="_blank" title="作者" class="beLink" data-v-06225672>p0jo</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Docker<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h1> <h2 id="docker-理念"><a href="#docker-理念" class="header-anchor">#</a> Docker 理念</h2> <blockquote><p>Docker的主要目标是“Build，Ship and Run Any App,Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的APP（可以是一个WEB应用或数据库应用等等）及其运行环境能够做到“一次封装，到处运行”。解决了运行环境和配置问题软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术。</p></blockquote> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195048442.png" alt="image-20220129195048442"></p> <h2 id="linux容器的实现方式"><a href="#linux容器的实现方式" class="header-anchor">#</a> Linux容器的实现方式</h2> <blockquote><p>一个正在运行的 Docker 容器，其实就是一个启用了多个 Linux Namespace 的应用进程，而这个进程能够使用的资源量，则受 Cgroups 配置的限制。这也是容器技术中一个非常重要的概念，即：容器是一个“单进程”模型。</p></blockquote> <p>一个“容器”，实际上是一个由 Linux Namespace、Linux Cgroups 和 rootfs 三种技术构建出来的进程的隔离环境。</p> <ol><li><p><strong>Namespace</strong> 的作用是“隔离”，它让应用进程只能看到该 Namespace 内的“世界”；修改进程视图的主要方法</p></li> <li><p><strong>Cgroups</strong> 的作用是“限制”，它给这个“世界”围上了一圈看不见的墙。制造约束的主要手段</p></li> <li><p>一组联合挂载在 /var/lib/docker/aufs/mnt 上的 <strong>rootfs</strong>，这一部分我们称为“容器镜像”（Container Image），是容器的静态视图；一个由 Namespace+Cgroups 构成的隔离环境，这一部分我们称为“容器运行时”（Container Runtime），是容器的动态视图。</p></li></ol> <h3 id="namespace"><a href="#namespace" class="header-anchor">#</a> NameSpace</h3> <p>在容器中看到只有自己一个进程，但是这个进程其实是在宿主机上的 只不过是一个独立的namespace</p> <p>定义了5个命名空间结构体，多个进程可以使用同一个namespace</p> <ol><li><p>UTS： 运行内核的名称、版本、底层体系结构类型等信息（UNIX Timesharing System）</p></li> <li><p>IPC： 与进程间通信（IPC)有关</p></li> <li><p>MNT：已经装载的文件系统的视图 Mount Namespace，用于让被隔离进程只看到当前 Namespace 里的挂载点信息；</p></li> <li><p>PID：有关进程ID的信息</p></li> <li><p>NET：网络相关的命名空间参数 Network Namespace，用于让被隔离进程看到当前 Namespace 里的网络设备和配置。</p></li></ol> <p>在 Linux 内核中，有很多资源和对象是不能被 Namespace 化的，最典型的例子就是：<strong>时间</strong>。</p> <p>为了让多个容器以沙盒的方式在宿主机上运行，就需要提前定义好各个容器能看到的边界。由于各个容器都是直接运行在宿主机系统上，因此需要内核对各个容器的上下文进行修改，让他们看上去是一个独立的操作系统。比如，指定PID为1的进程，指定网卡设备，指定文件系统挂载，指定用户等等。</p> <p>Linux操作系统内核从底层实现了为各个进程创建独立用户空间的功能，不同用户空间似于一个个独立的虚拟机系统，用户空间内部进程不能感知到其它用户空间中的进程状态。内核提供了六种Namespaces。</p> <table><thead><tr><th>UTS</th> <th>hostname and domainname</th> <th>主机名和域名隔离</th> <th>内核版本：2.6.19</th></tr></thead> <tbody><tr><td>User</td> <td></td> <td>用户隔离。运行进程的用户和组</td> <td>内核版本：3.8.x</td></tr> <tr><td>Mount</td> <td></td> <td>挂载点隔离。即挂载点隔离，主要指根目录</td> <td>内核版本：2.4.19</td></tr> <tr><td>IPC</td> <td>Inter-process-connection</td> <td>进程间通信隔离。消息队列、共享内容、信号量</td> <td>内核版本：2.6.19</td></tr> <tr><td>Pid</td> <td>Process</td> <td></td> <td></td></tr> <tr><td>ID</td> <td></td> <td>PID隔离</td> <td></td></tr> <tr><td>Net</td> <td>Network</td> <td>网络隔离。网络设备、协议栈、端口</td> <td>内核版本：2.6.29</td></tr></tbody></table> <h3 id="cgroups"><a href="#cgroups" class="header-anchor">#</a> Cgroups</h3> <p>Linux Cgroups 就是 Linux 内核中用来为进程设置资源限制的一个重要功能。</p> <p>Linux Cgroups 的全称是 Linux Control Group。它最主要的作用，就是限制一个进程组能够使用的资源上限，包括 CPU、内存、磁盘、网络带宽等等。</p> <p>此外，Cgroups 还能够对进程进行优先级设置、审计，以及将进程挂起和恢复等操作。</p> <h3 id="chroot"><a href="#chroot" class="header-anchor">#</a> Chroot</h3> <p>如果需要在一个宿主机上运行多个容器，且容器之间相互隔离，那么第一个就需要系统库文件的依赖，对于一个容器而言，需要将其需要的系统文件单独复制出来一份，放到指定目录，并且需要让进程认为这就是根目录，而不是去调用宿主机系统上的库文件。Chroot就是一个切换根目录的方式。</p> <h2 id="docker和虚拟机的区别"><a href="#docker和虚拟机的区别" class="header-anchor">#</a> Docker和虚拟机的区别</h2> <p>比较了 Docker 和传统虚拟化方式的不同之处：</p> <ul><li><p>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；</p></li> <li><p>而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核， 而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</p></li> <li><p>每个容器之间互相隔离，每个容器有自己的文件系统 ，容器之间进程不会相互影响，能区分计算资源。</p></li></ul> <h3 id="虚拟机"><a href="#虚拟机" class="header-anchor">#</a> 虚拟机</h3> <p>它可以在一种操作系统里面运行另一种操作系统，比如在Windows 系统里面运行Linux 系统。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。这类虚拟机完美的运行了另一套系统，能够使应用程序，操作系统和硬件三者之间的逻辑不变。</p> <p>虚拟机的缺点：</p> <ul><li>资源占用多</li> <li>冗余步骤多</li> <li>启动慢</li></ul> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195103937.png" alt="image-20220129195103937"></p> <h3 id="docker-2"><a href="#docker-2" class="header-anchor">#</a> Docker</h3> <p>Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。有了容器，就可以将软件运行所需的所有资源打包到一个隔离的容器中。容器与虚拟机不同，不需要捆绑一整套操作系统，只需要软件工作所需的库资源和设置。系统因此而变得高效轻量并保证部署在任何环境中的软件都能始终如一地运行。</p> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195116807.png" alt="image-20220129195116807"></p> <h2 id="docker的优势"><a href="#docker的优势" class="header-anchor">#</a> Docker的优势</h2> <p>Docker是一个Client-Server结构的系统，Docker守护进程运行在主机上， 然后通过Socket连接从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。 容器，是一个运行时环境，就是我们前面说到的集装箱。docker有着比虚拟机更少的抽象层。由亍docker不需要Hypervisor实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。docker利用的是宿主机的内核,而不需要Guest OS。因此,当新建一个容器时,docker不需要和虚拟机一样重新加载一个操作系统内核。仍而避免引寻、加载操作系统内核返个比较费时费资源的过程,当新建一个虚拟机时,虚拟机软件需要加载Guest OS,返个新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了返个过程,因此新建一个docker容器只需要几秒钟。</p> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195134595.png" alt="image-20220129195134595"></p> <h2 id="相关概念"><a href="#相关概念" class="header-anchor">#</a> 相关概念</h2> <p>需要正确的理解仓储/镜像/容器这几个概念:</p> <p>Docker 本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就似乎 image镜像文件。只有通过这个镜像文件才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。</p> <ul><li>image 文件生成的容器实例，本身也是一个文件，称为镜像文件。</li> <li>一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一个对应的运行实例，也就是我们的容器</li> <li>至于仓储，就是放了一堆镜像的地方，我们可以把镜像发布到仓储中，需要的时候从仓储中拉下来就可以了。</li></ul> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195154025.png" alt="image-20220129195154025"></p> <h3 id="镜像"><a href="#镜像" class="header-anchor">#</a> 镜像</h3> <p>Docker 镜像（Image）就是一个只读的模板。镜像可以用来创建 Docker 容器，一个镜像可以创建很多容器。</p> <p>docker镜像的命名标准：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>${registry_ name}/${repository. name}/${image. name}:${tag. name}
docker.io/library/alpine:3.10.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="容器"><a href="#容器" class="header-anchor">#</a> 容器</h3> <p>Docker 利用容器（Container）独立运行的一个或一组应用。容器是用镜像创建的运行实例。</p> <p>它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。
<strong>可以把容器看做是一个简易版的 Linux 环境</strong>（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p> <p>容器的定义和镜像几乎一模一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的。</p> <h3 id="仓库"><a href="#仓库" class="header-anchor">#</a> 仓库</h3> <p>仓库（Repository）是集中存放镜像文件的场所。</p> <p>仓库(Repository)和仓库注册服务器（Registry）是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个镜像，每个镜像有不同的标签（tag）。</p> <p>仓库分为公开仓库（Public）和私有仓库（Private）两种形式。</p> <p>最大的公开仓库是 <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，存放了数量庞大的镜像供用户下载。国内的公开仓库包括阿里云 、网易云等。</p> <h2 id="centos安装docker"><a href="#centos安装docker" class="header-anchor">#</a> Centos安装Docker</h2> <h3 id="_1-卸载旧版本docker"><a href="#_1-卸载旧版本docker" class="header-anchor">#</a> 1. 卸载旧版本Docker</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum remove <span class="token function">docker</span> <span class="token punctuation">\</span>
                  docker-client <span class="token punctuation">\</span>
                  docker-client-latest <span class="token punctuation">\</span>
                  docker-common <span class="token punctuation">\</span>
                  docker-latest <span class="token punctuation">\</span>
                  docker-latest-logrotate <span class="token punctuation">\</span>
                  docker-logrotate <span class="token punctuation">\</span>
                  docker-engine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-设置镜像仓库"><a href="#_2-设置镜像仓库" class="header-anchor">#</a> 2. 设置镜像仓库</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils
<span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    https://download.docker.com/linux/centos/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-安装docker"><a href="#_3-安装docker" class="header-anchor">#</a> 3. 安装Docker</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> <span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-compose-plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-配置镜像加速"><a href="#_4-配置镜像加速" class="header-anchor">#</a> 4. 配置镜像加速</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://t9rco7kp.mirror.aliyuncs.com&quot;]
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload

<span class="token comment"># 其他配置</span>

<span class="token comment"># daemon.json 配置介绍</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;graph&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data/docker&quot;</span>,
  <span class="token string">&quot;storage-driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;overlay2&quot;</span>,
  <span class="token string">&quot;insecure-registries&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;registry.access.redhat.com&quot;</span>,<span class="token string">&quot;quay.io&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://q2gr04ke.mirror.aliyuncs.com&gt;&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;bip&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.24.38.1/24&quot;</span>,
  <span class="token string">&quot;exec-opts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;native.cgroupdriver=systemd&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;live-restore&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment"># 配置项注意点：</span>
<span class="token comment"># graph: 该关键字未来将被弃用，可以采用 &quot;data-root&quot; 替代</span>
<span class="token comment"># storage-driver: 存储驱动，即分层文件系统</span>
<span class="token comment"># insecure-registries: 不安全的docker registries，即使用http协议推拉镜象</span>
<span class="token comment"># registry-mirrors: 加速站点，一般可以使用阿里、网易云、docker中国(&lt;https://registry.docker-cn.com&gt;)的地址</span>
<span class="token comment"># bip: 指定docker bridge地址(不能以.0结尾)，生产中建议采用 172.xx.yy.1/24,其中xx.yy为宿主机ip后四位，方便定位问题</span>
<span class="token comment"># 若启动失败，查看 /var/log/message 日志排错</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_5-启动docker并测试"><a href="#_5-启动docker并测试" class="header-anchor">#</a> 5. 启动Docker并测试</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
<span class="token function">docker</span> run hello-world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-docker-run逻辑图"><a href="#_6-docker-run逻辑图" class="header-anchor">#</a> 6. Docker Run逻辑图</h3> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195215440.png" alt="image-20220129195215440"></p> <h3 id="_99-卸载方式"><a href="#_99-卸载方式" class="header-anchor">#</a> 99. 卸载方式</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop <span class="token function">docker</span> 
yum -y remove docker-ce
<span class="token function">rm</span> -rf /var/lib/docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="docker-常用命令"><a href="#docker-常用命令" class="header-anchor">#</a> Docker 常用命令</h2> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195228538.png" alt="image-20220129195228538"></p> <h3 id="帮助相关"><a href="#帮助相关" class="header-anchor">#</a> 帮助相关</h3> <h4 id="查看版本"><a href="#查看版本" class="header-anchor">#</a> 查看版本</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195243064.png" alt="image-20220129195243064"></p> <h4 id="查看docker信息"><a href="#查看docker信息" class="header-anchor">#</a> 查看docker信息</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195255915.png" alt="image-20220129195255915"></p> <h4 id="查看帮助"><a href="#查看帮助" class="header-anchor">#</a> 查看帮助</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> --help
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="镜像相关命令"><a href="#镜像相关命令" class="header-anchor">#</a> 镜像相关命令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.查看本机中所有镜像</span>
<span class="token function">docker</span> images	--------------------------	列出本地所有镜像
-a			列出所有镜像（包含中间映像层）
-q			只显示镜像id

<span class="token comment"># 2.搜索镜像</span>
<span class="token function">docker</span> search <span class="token punctuation">[</span>options<span class="token punctuation">]</span> 镜像名	-------------------	去dockerhub上查询当前镜像
-s 指定值		列出收藏数不少于指定值的镜像
--no-trunc	  显示完整的镜像信息

<span class="token comment"># 3.从仓库下载镜像</span>
<span class="token function">docker</span> pull 镜像名<span class="token punctuation">[</span>:TAG<span class="token operator">|</span>@DIGEST<span class="token punctuation">]</span>	----------------- 下载镜像

<span class="token comment"># 4.删除镜像</span>
<span class="token function">docker</span> rmi 镜像名	--------------------------  删除镜像
-f		强制删除
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="登录退出dockerhub"><a href="#登录退出dockerhub" class="header-anchor">#</a> 登录退出DockerHub</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> login docker.io
<span class="token function">cat</span> /root/.docker/config.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195311257.png" alt="image-20220129195311257"></p> <h4 id="列举系统上的镜像"><a href="#列举系统上的镜像" class="header-anchor">#</a> 列举系统上的镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> images
options：
	-a   显示本机所有镜像
	-q   只显示id
	--digest  只显示摘要信息
	--no-trunc 显示完整镜像信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="查找镜像"><a href="#查找镜像" class="header-anchor">#</a> 查找镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> search xxx
options:
	--no-strunc 显示完整的镜像信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="拉取镜像"><a href="#拉取镜像" class="header-anchor">#</a> 拉取镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull xxx<span class="token punctuation">[</span>:版本<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="删除镜像"><a href="#删除镜像" class="header-anchor">#</a> 删除镜像</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> rmi xxx

eg.
<span class="token function">docker</span> rmi centos 删除一个镜像
<span class="token function">docker</span> rmi centos:latest centos:7.1 删除多个
<span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images -aq<span class="token variable">)</span></span> 删除全部
<span class="token function">docker</span> rmi -f xxx 强制删除
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="镜像标签"><a href="#镜像标签" class="header-anchor">#</a> 镜像标签</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> tag d4ff818577bc docker.io/zhangsan404/alpine:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195329232.png" alt="image-20220129195329232"></p> <h4 id="推送镜像到远端"><a href="#推送镜像到远端" class="header-anchor">#</a> 推送镜像到远端</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> push docker.io/zhangsan404/alpine:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="保存镜像到本地"><a href="#保存镜像到本地" class="header-anchor">#</a> 保存镜像到本地</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> save zhangsan404/alpine:test <span class="token operator">&gt;</span> alpine_test.tar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195339070.png" alt="image-20220129195339070"></p> <h4 id="本地镜像导入"><a href="#本地镜像导入" class="header-anchor">#</a> 本地镜像导入</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> load <span class="token operator">&lt;</span> alpine_test.tar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195349934.png" alt="image-20220129195349934"></p> <h3 id="容器相关命令"><a href="#容器相关命令" class="header-anchor">#</a> 容器相关命令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.运行容器</span>
<span class="token function">docker</span> run 镜像名	--------------------------	镜像名新建并启动容器
--name 					别名为容器起一个名字
-d							启动守护式容器（在后台启动容器）
-p 							映射端口号：原始端口号		 指定端口号启动

例：docker run -it --name myTomcat -p <span class="token number">8888</span>:8080 tomcat
<span class="token function">docker</span> run -d --name myTomcat -P tomcat

<span class="token comment"># 2.查看运行的容器</span>
<span class="token function">docker</span> <span class="token function">ps</span>					--------------------------	列出所有正在运行的容器
-a			正在运行的和历史运行过的容器
-q			静默模式，只显示容器编号

<span class="token comment"># 3.停止|关闭|重启容器</span>
<span class="token function">docker</span> start   容器名字或者容器id  --------------- 开启容器
<span class="token function">docker</span> restart 容器名或者容器id    --------------- 重启容器
<span class="token function">docker</span> stop  容器名或者容器id 	    ------------------ 正常停止容器运行
<span class="token function">docker</span> <span class="token function">kill</span>  容器名或者容器id      ------------------ 立即停止容器运行

<span class="token comment"># 4.删除容器</span>
<span class="token function">docker</span> <span class="token function">rm</span> -f 容器id和容器名     
<span class="token function">docker</span> <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -aq<span class="token variable">)</span></span>		--------------------------	删除所有容器

<span class="token comment"># 5.查看容器内进程</span>
<span class="token function">docker</span> <span class="token function">top</span> 容器id或者容器名 ------------------ 查看容器内的进程

<span class="token comment"># 6.查看查看容器内部细节</span>
<span class="token function">docker</span> inspect 容器id 		------------------ 查看容器内部细节

<span class="token comment"># 7.查看容器的运行日志</span>
<span class="token function">docker</span> logs <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> 容器id或容器名	------------------ 查看容器日志
-t			 加入时间戳
-f			 跟随最新的日志打印
--tail 	 数字	显示最后多少条

<span class="token comment"># 8.进入容器内部</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> 容器id 容器内命令 ------------------ 进入容器执行命令
-i		以交互模式运行容器，通常与-t一起使用
-t		分配一个伪终端    shell窗口   <span class="token function">bash</span> 

<span class="token comment"># 9.容器和宿主机之间复制文件</span>
<span class="token function">docker</span> <span class="token function">cp</span> 文件<span class="token operator">|</span>目录 容器id:容器路径           -----------------   将宿主机复制到容器内部
<span class="token function">docker</span> <span class="token function">cp</span> 容器id:容器内资源路径 宿主机目录路径  -----------------   将容器内资源拷贝到主机上

<span class="token comment"># 10.数据卷(volum)实现与宿主机共享目录</span>
<span class="token function">docker</span> run -v 宿主机的路径<span class="token operator">|</span>任意别名:/容器内的路径 镜像名
注意: 
<span class="token number">1</span>.如果是宿主机路径必须是绝对路径,宿主机目录会覆盖容器内目录内容
<span class="token number">2</span>.如果是别名则会在docker运行容器时自动在宿主机中创建一个目录,并将容器目录文件复制到宿主机中

<span class="token comment"># 11.打包镜像</span>
<span class="token function">docker</span> save 镜像名 -o  名称.tar

<span class="token comment"># 12.载入镜像</span>
<span class="token function">docker</span> load -i   名称.tar

<span class="token comment"># 13.容器打包成新的镜像</span>
<span class="token function">docker</span> commit -m <span class="token string">&quot;描述信息&quot;</span> -a <span class="token string">&quot;作者信息&quot;</span>   （容器id或者名称）打包的镜像名称:标签
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h4 id="新建并运行容器"><a href="#新建并运行容器" class="header-anchor">#</a> 新建并运行容器</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
options：
--name<span class="token operator">=</span><span class="token string">&quot;容器新名字&quot;</span><span class="token builtin class-name">:</span> 为容器指定一个名称；
-d: 后台运行容器，并返回容器ID，也即启动守护式容器；
-i：以交互模式运行容器，通常与 -t 同时使用；
-t：为容器重新分配一个伪输入终端，通常与 -i 同时使用；
-P: 随机端口映射；
-p: 指定端口映射，有以下四种格式
      ip:hostPort:containerPort
      ip::containerPort
      **hostPort:containerPort**
      containerPort

e.g.
<span class="token function">docker</span> run --name centos_demo01 -t -i centos  <span class="token comment"># 交互式方式运行</span>
<span class="token function">docker</span> run -d --name tomcat_demo01 -p <span class="token number">8081</span>:8080 tomcat <span class="token comment"># 后台运行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="查看容器"><a href="#查看容器" class="header-anchor">#</a> 查看容器</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">ps</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

options:
	-a    查看所有容器包括正在运行和停止的
	-q    显示id
  -n    显示最近创建的n个容器
	-l    显示最近创建的容器
	--no-stunc    不截断输出
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="退出容器的两种方式"><a href="#退出容器的两种方式" class="header-anchor">#</a> 退出容器的两种方式</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">exit</span>  <span class="token comment"># 容器停止</span>
CTRL+p+q
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="容器的启动、停止、重启、强制关闭"><a href="#容器的启动、停止、重启、强制关闭" class="header-anchor">#</a> 容器的启动、停止、重启、强制关闭</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> start xxx 
<span class="token function">docker</span> stop xxx
<span class="token function">docker</span> restart xxx
<span class="token function">docker</span> <span class="token function">kill</span> xxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="删除容器"><a href="#删除容器" class="header-anchor">#</a> 删除容器</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -aq<span class="token variable">)</span></span> <span class="token comment"># 强制删除全部容器               = docker ps -qa |Xargs docker rm -f</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看容器日志"><a href="#查看容器日志" class="header-anchor">#</a> 查看容器日志</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> logs <span class="token punctuation">[</span>options<span class="token punctuation">]</span> 容器id
options：
	-t 时间戳
	-f 跟随最新日志
	--tail 数字后显示多少条
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="查看容器内进程"><a href="#查看容器内进程" class="header-anchor">#</a> 查看容器内进程</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">top</span> 容器id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看容器内部细节"><a href="#查看容器内部细节" class="header-anchor">#</a> 查看容器内部细节</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> inspect 容器id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="重新进入正在运行的容器"><a href="#重新进入正在运行的容器" class="header-anchor">#</a> 重新进入正在运行的容器</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 容器id /bin/bash  <span class="token comment"># 打开新的终端   新进程 以这种方式进入exit不会结束容器的运行</span>
<span class="token function">docker</span> attach 容器id   <span class="token comment"># 直接进入容器启动的命令行终端</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="文件相互拷贝"><a href="#文件相互拷贝" class="header-anchor">#</a> 文件相互拷贝</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">cp</span> 容器id:容器路径 本机路径
<span class="token function">docker</span> <span class="token function">cp</span> 本机路径 容器id:容器内路径
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="将容器保存为镜像"><a href="#将容器保存为镜像" class="header-anchor">#</a> 将容器保存为镜像</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker commit -p 容器名称 docker.io/zhangsan404/alpine:test_01
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="镜像-2"><a href="#镜像-2" class="header-anchor">#</a> 镜像</h2> <h3 id="unionfs-联合文件系统"><a href="#unionfs-联合文件系统" class="header-anchor">#</a> UnionFS - 联合文件系统</h3> <blockquote><p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p></blockquote> <h3 id="docker镜像加载原理"><a href="#docker镜像加载原理" class="header-anchor">#</a> Docker镜像加载原理</h3> <p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p> <p>bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p> <p>rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195408200.png" alt="image-20220129195408200"></p> <h3 id="docker-commit"><a href="#docker-commit" class="header-anchor">#</a> Docker commit</h3> <blockquote><p>Docker commit 可以将一个容器打包为镜像。</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> commit -m<span class="token operator">=</span><span class="token string">&quot;描述信息&quot;</span> -a<span class="token operator">=</span><span class="token string">&quot;作者&quot;</span> 容器id 镜像名称:tag

e.g.
<span class="token function">docker</span> commit -m<span class="token operator">=</span><span class="token string">&quot;tomcat with demo/helloworld&quot;</span> -a<span class="token operator">=</span><span class="token string">&quot;jm&quot;</span> 0179893d97e7 jm/tomcat:1.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195424220.png" alt="image-20220129195424220"></p> <h2 id="容器数据卷"><a href="#容器数据卷" class="header-anchor">#</a> 容器数据卷</h2> <blockquote><p>Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。 为了能保存数据在docker中我们使用容器数据卷。</p></blockquote> <p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性。</p> <p>卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷</p> <p>特点：</p> <p>1：数据卷可在容器之间共享或重用数据
2：卷中的更改可以直接生效
3：数据卷中的更改不会包含在镜像的更新中
4：数据卷的生命周期一直持续到没有容器使用它为止</p> <h3 id="命令行创建容器数据卷"><a href="#命令行创建容器数据卷" class="header-anchor">#</a> 命令行创建容器数据卷</h3> <h4 id="创建容器卷"><a href="#创建容器卷" class="header-anchor">#</a> 创建容器卷</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>	<span class="token function">docker</span> run -ti --name demo01 -v ~/myfile:/opt:ro centos:latest <span class="token comment"># 带权限</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看容器卷挂载情况"><a href="#查看容器卷挂载情况" class="header-anchor">#</a> 查看容器卷挂载情况</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> inspect demo01  <span class="token comment"># 查看容器详细信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195436762.png" alt="image-20220129195436762"></p> <h3 id="dockerfile创建容器数据卷"><a href="#dockerfile创建容器数据卷" class="header-anchor">#</a> Dockerfile创建容器数据卷</h3> <ol><li>创建一个文件夹</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> MyDockerfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>创建Dockerfile文件</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> Dockerfile

FROM centos   <span class="token comment"># 导入centos镜像</span>
VOLUME <span class="token punctuation">[</span><span class="token string">&quot;/dataVolumeContainer1&quot;</span>,<span class="token string">&quot;/dataVolumeContainer2&quot;</span><span class="token punctuation">]</span>  <span class="token comment"># 创建两个容器数据卷，由于主机的文件夹无法指定，这里的容器数据卷只有docker方向的</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;finished,--------success1&quot;</span>
CMD /bin/bash  <span class="token comment"># 执行bash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>构建容器</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> build -f dockerfile位置 -t 输出的镜像名称 <span class="token builtin class-name">.</span> <span class="token comment"># 当前目录</span>

e.g.
<span class="token function">docker</span> build -f ~/MyDockerfile/Dockerfile -t jm/centos_jm:1.1 <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195459345.png" alt="image-20220129195459345"></p> <p>默认主机端数据卷对接位置：</p> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195510155.png" alt="image-20220129195510155"></p> <h3 id="数据卷容器"><a href="#数据卷容器" class="header-anchor">#</a> 数据卷容器</h3> <blockquote><p>命名的容器挂载数据卷，其它容器通过挂载这个(父容器)实现数据共享，挂载数据卷的容器，称之为数据卷容器</p></blockquote> <p>创建父容器</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -ti --name dc01 jm/jm_centos:1.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建子容器</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -ti --name dc02 --volumes-from dc01 jm/jm_centos:1.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>子容器和父容器共享数据卷，当父容器删除时，子容器内容不会删除。可以理解为容器和数据卷分离，容器没了，数据卷还在。</p> <h2 id="docker安装常见的服务"><a href="#docker安装常见的服务" class="header-anchor">#</a> Docker安装常见的服务</h2> <h3 id="docker-安装-mysql"><a href="#docker-安装-mysql" class="header-anchor">#</a> Docker 安装 Mysql</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.拉取mysql镜像到本地</span>
<span class="token function">docker</span> pull mysql:tag <span class="token punctuation">(</span>tag不加默认最新版本<span class="token punctuation">)</span>

<span class="token comment"># 2.运行mysql服务</span>
<span class="token function">docker</span> run --name mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -d mysql:tag  						  --没有暴露外部端口外部不能连接
<span class="token function">docker</span> run --name mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -p <span class="token number">3306</span>:3306 -d  mysql:tag  --没有暴露外部端口

<span class="token comment"># 3.进入mysql容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 容器名称<span class="token operator">|</span>容器id <span class="token function">bash</span>

<span class="token comment"># 4.外部查看mysql日志</span>
<span class="token function">docker</span> logs 容器名称<span class="token operator">|</span>容器id

<span class="token comment"># 5.使用自定义配置参数</span>
<span class="token function">docker</span> run --name mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -d mysql:tag

<span class="token comment"># 6.将容器数据位置与宿主机位置挂载保证数据安全</span>
<span class="token function">docker</span> run --name mysql -v /root/mysql/data:/var/lib/mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -p <span class="token number">3306</span>:3306 -d mysql:tag

<span class="token comment"># 7.通过其他客户端访问 如在window系统|macos系统使用客户端工具访问</span>

<span class="token comment"># 8.将mysql数据库备份为sql文件</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> mysql<span class="token operator">|</span>容器id <span class="token function">sh</span> -c <span class="token string">'exec mysqldump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;'</span> <span class="token operator">&gt;</span> /root/all-databases.sql  --导出全部数据
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> mysql <span class="token function">sh</span> -c <span class="token string">'exec mysqldump --databases 库表 -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;'</span> <span class="token operator">&gt;</span> /root/all-databases.sql  --导出指定库数据
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> mysql <span class="token function">sh</span> -c <span class="token string">'exec mysqldump --no-data --databases 库表 -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;'</span> <span class="token operator">&gt;</span> /root/all-databases.sql  --导出指定库数据不要数据

<span class="token comment"># 9.执行sql文件到mysql中</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -i mysql <span class="token function">sh</span> -c <span class="token string">'exec mysql -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;'</span> <span class="token operator">&lt;</span> /root/xxx.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="docker安装redis"><a href="#docker安装redis" class="header-anchor">#</a> Docker安装Redis</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.在docker hub搜索redis镜像</span>
<span class="token function">docker</span> search redis

<span class="token comment"># 2.拉取redis镜像到本地</span>
<span class="token function">docker</span> pull redis

<span class="token comment"># 3.启动redis服务运行容器</span>
<span class="token function">docker</span> run --name redis -d redis:tag <span class="token punctuation">(</span>没有暴露外部端口<span class="token punctuation">)</span>
<span class="token function">docker</span> run --name redis -p <span class="token number">6379</span>:6379 -d redis:tag <span class="token punctuation">(</span>暴露外部宿主机端口为6379进行连接<span class="token punctuation">)</span> 

<span class="token comment"># 4.查看启动日志</span>
<span class="token function">docker</span> logs -t -f 容器id<span class="token operator">|</span>容器名称

<span class="token comment"># 5.进入容器内部查看</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 容器id<span class="token operator">|</span>名称 <span class="token function">bash</span>  

<span class="token comment"># 6.加载外部自定义配置启动redis容器</span>
默认情况下redis官方镜像中没有redis.conf配置文件 需要去官网下载指定版本的配置文件
<span class="token number">1</span>. <span class="token function">wget</span> http://download.redis.io/releases/redis-5.0.8.tar.gz  下载官方安装包
<span class="token number">2</span>. 将官方安装包中配置文件进行复制到宿主机指定目录中如 /root/redis/redis.conf文件
<span class="token number">3</span>. 修改需要自定义的配置
<span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0 开启远程权限
appenonly <span class="token function">yes</span> 开启aof持久化
<span class="token number">4</span>. 加载配置启动
<span class="token function">docker</span> run --name redis -v /root/redis:/usr/local/etc/redis -p <span class="token number">6379</span>:6379 -d redis redis-server /usr/local/etc/redis/redis.conf  

<span class="token comment"># 7.将数据目录挂在到本地保证数据安全</span>
<span class="token function">docker</span> run --name redis -v /root/redis/data:/data -v /root/redis/redis.conf:/usr/local/etc/redis/redis.conf -p <span class="token number">6379</span>:6379 -d redis redis-server 					/usr/local/etc/redis/redis.conf  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="docker-安装-nginx"><a href="#docker-安装-nginx" class="header-anchor">#</a> Docker 安装 nginx</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.在docker hub搜索nginx</span>
<span class="token function">docker</span> search nginx

<span class="token comment"># 2.拉取nginx镜像到本地</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker pull nginx</span>
Using default tag: latest
latest: Pulling from library/nginx
afb6ec6fdc1c: Pull complete 
b90c53a0b692: Pull complete 
11fa52a0fdc0: Pull complete 
Digest: sha256:30dfa439718a17baafefadf16c5e7c9d0a1cde97b4fd84f63b69e13513be7097
Status: Downloaded newer image <span class="token keyword">for</span> nginx:latest
docker.io/library/nginx:latest

<span class="token comment"># 3.启动nginx容器</span>
<span class="token function">docker</span> run -p <span class="token number">80</span>:80 --name nginx01 -d nginx

<span class="token comment"># 4.进入容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it nginx01 /bin/bash
查找目录:  <span class="token function">whereis</span> nginx
配置文件:  /etc/nginx/nginx.conf

<span class="token comment"># 5.复制配置文件到宿主机</span>
<span class="token function">docker</span> <span class="token function">cp</span> nginx01<span class="token punctuation">(</span>容器id<span class="token operator">|</span>容器名称<span class="token punctuation">)</span>:/etc/nginx/nginx.conf 宿主机名录

<span class="token comment"># 6.挂在nginx配置以及html到宿主机外部</span>
<span class="token function">docker</span> run --name nginx02 -v /root/nginx/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/html:/usr/share/nginx/html -p <span class="token number">80</span>:80 -d nginx		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="docker-安装-tomcat"><a href="#docker-安装-tomcat" class="header-anchor">#</a> Docker 安装 Tomcat</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.在docker hub搜索tomcat</span>
<span class="token function">docker</span> search tomcat

<span class="token comment"># 2.下载tomcat镜像</span>
<span class="token function">docker</span> pull tomcat

<span class="token comment"># 3.运行tomcat镜像</span>
<span class="token function">docker</span> run -p <span class="token number">8080</span>:8080 -d --name mytomcat tomcat

<span class="token comment"># 4.进入tomcat容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it mytomcat /bin/bash

<span class="token comment"># 5.将webapps目录挂载在外部</span>
<span class="token function">docker</span> run -p <span class="token number">8080</span>:8080 -v /root/webapps:/usr/local/tomcat/webapps -d --name mytomcat tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="docker-安装-es"><a href="#docker-安装-es" class="header-anchor">#</a> Docker 安装 ES</h3> <h4 id="_0-拉取镜像-启动容器"><a href="#_0-拉取镜像-启动容器" class="header-anchor">#</a> 0. 拉取镜像 启动容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.dockerhub 拉取镜像</span>
	<span class="token function">docker</span> pull elasticsearch:6.4.2
<span class="token comment"># 2.查看docker镜像</span>
	<span class="token function">docker</span> images
<span class="token comment"># 3.运行docker镜像</span>
	<span class="token function">docker</span> run -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 elasticsearch:6.4.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501134102408.png" alt="image-20220501134102408"></p> <h4 id="_1-进行相关的配置"><a href="#_1-进行相关的配置" class="header-anchor">#</a> 1. 进行相关的配置</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.在centos虚拟机中，修改配置sysctl.conf</span>
	<span class="token function">vim</span> /etc/sysctl.conf
<span class="token comment"># 2.加入如下配置</span>
	vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span> 
<span class="token comment"># 3.启用配置</span>
	sysctl -p
	注：这一步是为了防止启动容器时，报出如下错误：
	bootstrap checks failed max virtual memory areas vm.max_map_count <span class="token punctuation">[</span><span class="token number">65530</span><span class="token punctuation">]</span> likely too low, increase to at least <span class="token punctuation">[</span><span class="token number">262144</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-启动容器"><a href="#_2-启动容器" class="header-anchor">#</a> 2. 启动容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 0.复制容器中data目录到宿主机中</span>
<span class="token function">docker</span> <span class="token function">cp</span> 容器id:/usr/share/share/elasticsearch/data /root/es
<span class="token comment"># 1.运行ES容器 指定jvm内存大小并指定ik分词器位置</span>
<span class="token function">docker</span> run -d --name es -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms128m -Xmx128m&quot;</span> -v /root/es/plugins:/usr/share/elasticsearch/plugins -v /root/es/data:/usr/share/elasticsearch/data elasticsearch:6.4.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-安装ik分词器"><a href="#_3-安装ik分词器" class="header-anchor">#</a> 3.安装IK分词器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.下载对应版本的IK分词器</span>
<span class="token function">wget</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.4.2/elasticsearch-analysis-ik-6.4.2.zip

<span class="token comment"># 2.解压到plugins文件夹中</span>
yum <span class="token function">install</span> -y <span class="token function">unzip</span>
<span class="token function">unzip</span> -d ik elasticsearch-analysis-ik-6.4.2.zip

<span class="token comment"># 3.添加自定义扩展词和停用词</span>
<span class="token builtin class-name">cd</span> plugins/elasticsearch/config
<span class="token function">vim</span> IKAnalyzer.cfg.xml
<span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>comment<span class="token operator">&gt;</span>IK Analyzer 扩展配置<span class="token operator">&lt;</span>/comment<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--用户可以在这里配置自己的扩展字典 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>entry <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token string">&quot;ext_dict&quot;</span><span class="token operator">&gt;</span>ext_dict.dic<span class="token operator">&lt;</span>/entry<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--用户可以在这里配置自己的扩展停止词字典--<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>entry <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token string">&quot;ext_stopwords&quot;</span><span class="token operator">&gt;</span>ext_stopwords.dic<span class="token operator">&lt;</span>/entry<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/properties<span class="token operator">&gt;</span>

<span class="token comment"># 4.在ik分词器目录下config目录中创建ext_dict.dic文件   编码一定要为UTF-8才能生效</span>
<span class="token function">vim</span> ext_dict.dic 加入扩展词即可
<span class="token comment"># 5. 在ik分词器目录下config目录中创建ext_stopword.dic文件 </span>
<span class="token function">vim</span> ext_stopwords.dic 加入停用词即可

<span class="token comment"># 6.重启容器生效</span>
<span class="token function">docker</span> restart 容器id
<span class="token comment"># 7.将此容器提交成为一个新的镜像</span>
<span class="token function">docker</span> commit -a<span class="token operator">=</span><span class="token string">&quot;xiaochen&quot;</span> -m<span class="token operator">=</span><span class="token string">&quot;es with IKAnalyzer&quot;</span> 容器id xiaochen/elasticsearch:6.4.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_4-安装kibana"><a href="#_4-安装kibana" class="header-anchor">#</a> 4. 安装Kibana</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.下载kibana镜像到本地</span>
<span class="token function">docker</span> pull kibana:6.4.2

<span class="token comment"># 2.启动kibana容器</span>
<span class="token function">docker</span> run -d --name kibana -e <span class="token assign-left variable">ELASTICSEARCH_URL</span><span class="token operator">=</span>http://10.15.0.3:9200 -p <span class="token number">5601</span>:5601 kibana:6.4.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="docker-常见问题处置"><a href="#docker-常见问题处置" class="header-anchor">#</a> Docker 常见问题处置</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker search mysql 或者 docker pull 这些命令无法使用</span>
Error response from daemon: Get https://index.docker.io/v1/search?q<span class="token operator">=</span>mysql<span class="token operator">&amp;</span><span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token number">25</span>: x509: certificate has expired or is not yet valid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501134345146.png" alt="image-20220501134345146"></p> <p>注意:<strong>这个错误的原因在于是系统的时间和docker hub时间不一致,需要做系统时间与网络时间同步</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.安装时间同步</span>
	<span class="token function">sudo</span> yum -y <span class="token function">install</span> ntp ntpdate
<span class="token comment"># 2.同步时间</span>
	<span class="token function">sudo</span> ntpdate cn.pool.ntp.org
<span class="token comment"># 3.查看本机时间</span>
	<span class="token function">date</span>
<span class="token comment"># 4.从新测试</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h2> <blockquote><p>Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p></blockquote> <h3 id="什么是dockerfile"><a href="#什么是dockerfile" class="header-anchor">#</a> 什么是Dockerfile</h3> <p>Dockerfile可以认为是<strong>Docker镜像的描述文件，是由一系列命令和参数构成的脚本</strong>。主要作用是<strong>用来构建docker镜像的构建文件</strong>。</p> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501134810645.png" alt="image-20220501134810645"></p> <ul><li><strong>通过架构图可以看出通过DockerFile可以直接构建镜像</strong></li></ul> <h3 id="dockerfile解析过程"><a href="#dockerfile解析过程" class="header-anchor">#</a> Dockerfile解析过程</h3> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501134802852.png" alt="image-20220501134802852"></p> <h3 id="dockerfile的保留命令"><a href="#dockerfile的保留命令" class="header-anchor">#</a> Dockerfile的保留命令</h3> <p>官方说明:https://docs.docker.com/engine/reference/builder/</p> <table><thead><tr><th>保留字</th> <th>作用</th></tr></thead> <tbody><tr><td><strong>FROM</strong></td> <td><strong>当前镜像是基于哪个镜像的</strong> <code>第一个指令必须是FROM</code></td></tr> <tr><td>MAINTAINER</td> <td>镜像维护者的姓名和邮箱地址</td></tr> <tr><td><strong>RUN</strong></td> <td><strong>构建镜像时需要运行的指令</strong></td></tr> <tr><td><strong>EXPOSE</strong></td> <td><strong>当前容器对外暴露出的端口号</strong></td></tr> <tr><td><strong>WORKDIR</strong></td> <td><strong>指定在创建容器后，终端默认登录进来的工作目录，一个落脚点</strong></td></tr> <tr><td><strong>ENV</strong></td> <td><strong>用来在构建镜像过程中设置环境变量</strong></td></tr> <tr><td><strong>ADD</strong></td> <td><strong>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar包</strong></td></tr> <tr><td><strong>COPY</strong></td> <td><strong>类似于ADD，拷贝文件和目录到镜像中<br>将从构建上下文目录中&lt;原路径&gt;的文件/目录复制到新的一层的镜像内的&lt;目标路径&gt;位置</strong></td></tr> <tr><td><strong>VOLUME</strong></td> <td><strong>容器数据卷，用于数据保存和持久化工作</strong></td></tr> <tr><td><strong>CMD</strong></td> <td><strong>指定一个容器启动时要运行的命令<br>Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换</strong></td></tr> <tr><td><strong>ENTRYPOINT</strong></td> <td><strong>指定一个容器启动时要运行的命令<br>ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序及其参数</strong></td></tr></tbody></table> <h4 id="from"><a href="#from" class="header-anchor">#</a> FROM</h4> <ul><li><p>基于那个镜像进行构建新的镜像,在构建时会自动从docker hub拉取base镜像 必须作为Dockerfile的第一个指令出现</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span>  &lt;image&gt;</span>
<span class="token instruction"><span class="token keyword">FROM</span>  &lt;image&gt;[:&lt;tag&gt;]     使用版本不写为latest</span>
<span class="token instruction"><span class="token keyword">FROM</span>  &lt;image&gt;[@&lt;digest&gt;]  使用摘要</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h4 id="maintainer"><a href="#maintainer" class="header-anchor">#</a> MAINTAINER</h4> <ul><li><p>镜像维护者的姓名和邮箱地址[废弃]</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">MAINTAINER</span> &lt;name&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="run"><a href="#run" class="header-anchor">#</a> RUN</h4> <ul><li><p>RUN指令将在当前映像之上的新层中执行任何命令并提交结果。生成的提交映像将用于Dockerfile中的下一步</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">RUN</span> &lt;command&gt; (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo hello</span>

<span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">&quot;executable&quot;</span>, <span class="token string">&quot;param1&quot;</span>, <span class="token string">&quot;param2&quot;</span>] (exec form)</span>
<span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">&quot;/bin/bash&quot;</span>, <span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;echo hello&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h4 id="expose"><a href="#expose" class="header-anchor">#</a> EXPOSE</h4> <ul><li><p>用来指定构建的镜像在运行为容器时对外暴露的端口</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">EXPOSE</span> 80/tcp  如果没有显示指定则默认暴露都是tcp</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80/udp</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h4 id="cmd"><a href="#cmd" class="header-anchor">#</a> CMD</h4> <ul><li><p>用来为启动的容器指定执行的命令,在Dockerfile中只能有一条CMD指令。如果列出多个命令，则只有最后一个命令才会生效。</p></li> <li><p>注意: <strong>Dockerfile中只能有一条CMD指令。如果列出多个命令，则只有最后一个命令才会生效。</strong></p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;executable&quot;</span>,<span class="token string">&quot;param1&quot;</span>,<span class="token string">&quot;param2&quot;</span>] (exec form, this is the preferred form)</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;param1&quot;</span>,<span class="token string">&quot;param2&quot;</span>] (as default parameters to ENTRYPOINT)</span>
<span class="token instruction"><span class="token keyword">CMD</span> command param1 param2 (shell form)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h4 id="workdir"><a href="#workdir" class="header-anchor">#</a> WORKDIR</h4> <ul><li><p>用来为Dockerfile中的任何RUN、CMD、ENTRYPOINT、COPY和ADD指令设置工作目录。如果WORKDIR不存在，即使它没有在任何后续Dockerfile指令中使用，它也将被创建。</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">WORKDIR</span> /path/to/workdir</span>

<span class="token instruction"><span class="token keyword">WORKDIR</span> /a</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> b</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> c</span>
`注意:WORKDIR指令可以在Dockerfile中多次使用。如果提供了相对路径，则该路径将与先前WORKDIR指令的路径相对`
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <h4 id="env"><a href="#env" class="header-anchor">#</a> ENV</h4> <ul><li><p>用来为构建镜像设置环境变量。这个值将出现在构建阶段中所有后续指令的环境中。</p></li> <li><p>语法：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span>
<span class="token instruction"><span class="token keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h4 id="add"><a href="#add" class="header-anchor">#</a> ADD</h4> <ul><li><p>用来从context上下文复制新文件、目录或远程文件url，并将它们添加到位于指定路径的映像文件系统中。</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ADD</span> hom* /mydir/       通配符添加多个文件</span>
<span class="token instruction"><span class="token keyword">ADD</span> hom?.txt /mydir/   通配符添加</span>
<span class="token instruction"><span class="token keyword">ADD</span> test.txt relativeDir/  可以指定相对路径</span>
<span class="token instruction"><span class="token keyword">ADD</span> test.txt /absoluteDir/ 也可以指定绝对路径</span>
<span class="token instruction"><span class="token keyword">ADD</span> url </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h4 id="copy"><a href="#copy" class="header-anchor">#</a> COPY</h4> <ul><li><p>用来将context目录中指定文件复制到镜像的指定目录中</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">COPY</span> src dest</span>
<span class="token instruction"><span class="token keyword">COPY</span> [<span class="token string">&quot;&lt;src&gt;&quot;</span>,... <span class="token string">&quot;&lt;dest&gt;&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h4 id="volume"><a href="#volume" class="header-anchor">#</a> VOLUME</h4> <ul><li><p>用来定义容器运行时可以挂在到宿主机的目录</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">VOLUME</span> [<span class="token string">&quot;/data&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="entrypoint"><a href="#entrypoint" class="header-anchor">#</a> ENTRYPOINT</h4> <ul><li><p>用来指定容器启动时执行命令和CMD类似</p></li> <li><p>语法:</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>  [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> command param1 param2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ENTRYPOINT指令，往往用于设置容器启动后的<strong>第一个命令</strong>，这对一个容器来说往往是固定的。
CMD指令，往往用于设置容器启动的第一个命令的<strong>默认参数</strong>，这对一个容器来说可以是变化的。</p></li></ul> <h4 id="onbuild"><a href="#onbuild" class="header-anchor">#</a> ONBUILD</h4> <p>触发器，当构建一个被继承的Dockerfile时运行的命令，父镜像在被子镜像集成之后，onbuild被触发</p> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195611002.png" alt="image-20220129195611002"></p> <h3 id="dockerfile-打包-springboot项目"><a href="#dockerfile-打包-springboot项目" class="header-anchor">#</a> Dockerfile 打包 Springboot项目</h3> <h4 id="_0-打包本地项目"><a href="#_0-打包本地项目" class="header-anchor">#</a> 0. 打包本地项目</h4> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501142139702.png" alt="image-20220501142139702"></p> <h4 id="_1-将可运行项目放入linux虚拟机中"><a href="#_1-将可运行项目放入linux虚拟机中" class="header-anchor">#</a> 1. 将可运行项目放入linux虚拟机中</h4> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501142210304.png" alt="image-20220501142210304"></p> <h4 id="_3-编写dockerfile"><a href="#_3-编写dockerfile" class="header-anchor">#</a> 3. 编写dockerFile</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /ems</span>
<span class="token instruction"><span class="token keyword">ADD</span> ems.jar /ems</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8989</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;java&quot;</span>,<span class="token string">&quot;-jar&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;ems.jar&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-构建运行"><a href="#_4-构建运行" class="header-anchor">#</a> 4. 构建运行</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ems<span class="token punctuation">]</span><span class="token comment"># docker build -t ems .</span>
<span class="token punctuation">[</span>root@localhost ems<span class="token punctuation">]</span><span class="token comment"># docker run -p 8989:8989 ems</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="本地镜像发布"><a href="#本地镜像发布" class="header-anchor">#</a> 本地镜像发布</h2> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>&lt;https://cr.console.aliyun.com/cn-beijing/instance/repositories&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220129195629643.png" alt="image-20220129195629643"></p> <p><strong>1. 登录阿里云Docker Registry</strong> <code>$ sudo docker login --username=153****2135 registry.cn-beijing.aliyuncs.com</code></p> <p>用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。
您可以在访问凭证页面修改凭证密码。</p> <h3 id="_2-从registry中拉取镜像"><a href="#_2-从registry中拉取镜像" class="header-anchor">#</a> 2. 从Registry中拉取镜像</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker pull registry.cn-beijing.aliyuncs.com/csbugless/test:[镜像版本号]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-将镜像推送到registry"><a href="#_3-将镜像推送到registry" class="header-anchor">#</a> 3. 将镜像推送到Registry</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker login --username=153****2135 registry.cn-beijing.aliyuncs.com
$ sudo docker tag [ImageId] registry.cn-beijing.aliyuncs.com/csbugless/test:[镜像版本号]
$ sudo docker push registry.cn-beijing.aliyuncs.com/csbugless/test:[镜像版本号]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。</p> <h3 id="_4-选择合适的镜像仓库地址"><a href="#_4-选择合适的镜像仓库地址" class="header-anchor">#</a> 4. 选择合适的镜像仓库地址</h3> <p>从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。</p> <p>如果您使用的机器位于VPC网络，请使用 <a href="http://registry-vpc.cn-beijing.aliyuncs.com" target="_blank" rel="noopener noreferrer">registry-vpc.cn-beijing.aliyuncs.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 作为Registry的域名登录。</p> <h3 id="_5-示例"><a href="#_5-示例" class="header-anchor">#</a> 5. 示例</h3> <p>使用&quot;docker tag&quot;命令重命名镜像，并将它通过专有网络地址推送至Registry。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker imagesREPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZEregistry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB$ sudo docker tag 37bb9c63c8b2 registry-vpc.cn-beijing.aliyuncs.com/acs/agent:0.7-dfb6816
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 &quot;docker push&quot; 命令将该镜像推送至远程。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker push registry-vpc.cn-beijing.aliyuncs.com/acs/agent:0.7-dfb6816
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="高级网络和容器卷"><a href="#高级网络和容器卷" class="header-anchor">#</a> 高级网络和容器卷</h2> <h3 id="高级网络配置"><a href="#高级网络配置" class="header-anchor">#</a> 高级网络配置</h3> <h4 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h4> <p>当 Docker 启动时，会自动在主机上创建一个 <code>docker0</code> 虚拟网桥，实际上是 Linux 的一个 bridge，可以理解为一个软件交换机。它会在挂载到它的网口之间进行转发。</p> <p>同时，Docker 随机分配一个本地未占用的私有网段（在 <a href="https://tools.ietf.org/html/rfc1918" target="_blank" rel="noopener noreferrer">RFC1918<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中定义）中的一个地址给 <code>docker0</code> 接口。比如典型的 <code>172.17.42.1</code>，掩码为 <code>255.255.0.0</code>。此后启动的容器内的网口也会自动分配一个同一网段（<code>172.17.0.0/16</code>）的地址。</p> <p>当创建一个 Docker 容器的时候，同时会创建了一对 <code>veth pair</code> 接口（当数据包发送到一个接口时，另外一个接口也可以收到相同的数据包）。这对接口一端在容器内，即 <code>eth0</code>；另一端在本地并被挂载到 <code>docker0</code> 网桥，名称以 <code>veth</code> 开头（例如 <code>vethAQI2QT</code>）。通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。Docker 就创建了在主机和所有容器之间一个虚拟共享网络。</p> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501142520315.png" alt="image-20220501142520315"></p> <h4 id="查看网络信息"><a href="#查看网络信息" class="header-anchor">#</a> 查看网络信息</h4> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> docker network ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="创建一个网桥"><a href="#创建一个网桥" class="header-anchor">#</a> 创建一个网桥</h4> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> docker network create -d bridge 网桥名称</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="删除一个网桥"><a href="#删除一个网桥" class="header-anchor">#</a> 删除一个网桥</h4> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> docker network rm 网桥名称</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="容器之前使用网络通信"><a href="#容器之前使用网络通信" class="header-anchor">#</a> 容器之前使用网络通信</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.查询当前网络配置</span>
- <span class="token function">docker</span> network <span class="token function">ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
8e424e5936b7        bridge              bridge              <span class="token builtin class-name">local</span>
17d974db02da        docker_gwbridge     bridge              <span class="token builtin class-name">local</span>
d6c326e433f7        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
<span class="token comment"># 2.创建桥接网络</span>
- <span class="token function">docker</span> network create -d bridge info
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker network create -d bridge info</span>
6e4aaebff79b1df43a064e0e8fdab08f52d64ce34db78dd5184ce7aaaf550a2f
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
8e424e5936b7        bridge              bridge              <span class="token builtin class-name">local</span>
17d974db02da        docker_gwbridge     bridge              <span class="token builtin class-name">local</span>
d6c326e433f7        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
6e4aaebff79b        info                bridge              <span class="token builtin class-name">local</span>
<span class="token comment"># 3.启动容器指定使用网桥</span>
- <span class="token function">docker</span> run -d -p <span class="token number">8890</span>:80 --name nginx001 --network info nginx 
- <span class="token function">docker</span> run -d -p <span class="token number">8891</span>:80 --name nginx002 --network info nginx 
注意:一旦指定网桥后--name指定名字就是主机名,多个容器指定在同一个网桥时,可以在任意一个容器中使用主机名与容器进行互通
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8890:80 --name nginx001 --network info nginx </span>
c315bcc94e9ddaa36eb6c6f16ca51592b1ac8bf1ecfe9d8f01d892f3f10825fe
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8891:80 --name nginx002 --network info nginx</span>
f8682db35dd7fb4395f90edb38df7cad71bbfaba71b6a4c6e2a3a525cb73c2a5
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
f8682db35dd7        nginx               <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">3</span> seconds ago       Up <span class="token number">2</span> seconds        <span class="token number">0.0</span>.0.0:8891-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx002
c315bcc94e9d        nginx               <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes        <span class="token number">0.0</span>.0.0:8890-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx001
b63169d43792        mysql:5.7.19        <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes        <span class="token number">3306</span>/tcp               mysql_mysql.1.s75qe5kkpwwttyf0wrjvd2cda
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it f8682db35dd7 /bin/bash</span>
root@f8682db35dd7:/<span class="token comment"># curl http://nginx001</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="高级数据卷配置"><a href="#高级数据卷配置" class="header-anchor">#</a> 高级数据卷配置</h3> <h4 id="说明-2"><a href="#说明-2" class="header-anchor">#</a> 说明</h4> <p><code>数据卷</code> 是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：</p> <ul><li><code>数据卷</code> 可以在容器之间共享和重用</li> <li>对 <code>数据卷</code> 的修改会立马生效</li> <li>对 <code>数据卷</code> 的更新，不会影响镜像</li> <li><code>数据卷</code> 默认会一直存在，即使容器被删除</li></ul> <blockquote><p>注意：<code>数据卷</code> 的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会复制到数据卷中（仅数据卷为空时会复制）。</p></blockquote> <h4 id="创建数据卷"><a href="#创建数据卷" class="header-anchor">#</a> 创建数据卷</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker volume create my-vol</span>
my-vol
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="查看数据卷"><a href="#查看数据卷" class="header-anchor">#</a> 查看数据卷</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect my-vol       </span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-11-25T11:43:56+08:00&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/my-vol/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my-vol&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="挂载数据卷"><a href="#挂载数据卷" class="header-anchor">#</a> 挂载数据卷</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name web  -v my-vol:/usr/share/nginx/html  nginx</span>
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker inspect web</span>
				<span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my-vol&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/my-vol/_data&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>,
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;z&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="删除数据卷"><a href="#删除数据卷" class="header-anchor">#</a> 删除数据卷</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> volume <span class="token function">rm</span> my-vol
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="docker-compose"><a href="#docker-compose" class="header-anchor">#</a> Docker compose</h2> <h3 id="docker-compose使用"><a href="#docker-compose使用" class="header-anchor">#</a> docker compose使用</h3> <h4 id="_1-相关概念"><a href="#_1-相关概念" class="header-anchor">#</a> 1.相关概念</h4> <p>首先介绍几个术语。</p> <ul><li>服务 (<code>service</code>)：一个应用容器，实际上可以运行多个相同镜像的实例。</li> <li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元。∂一个项目可以由多个服务（容器）关联而成，<code>Compose</code> 面向项目进行管理。</li></ul> <h4 id="_2-场景"><a href="#_2-场景" class="header-anchor">#</a> 2.场景</h4> <p>最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。</p> <ul><li>springboot应用</li> <li>mysql服务</li> <li>redis服务</li> <li>elasticsearch服务</li> <li>.......</li></ul> <h4 id="_3-docker-compose模板"><a href="#_3-docker-compose模板" class="header-anchor">#</a> 3.docker-compose模板</h4> <ul><li>参考文档:https://docker_practice.gitee.io/zh-cn/compose/compose_file.html</li></ul> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.0&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysqldb</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.19
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3306:3306&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/mysql/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
      <span class="token punctuation">-</span> /root/mysql/logs<span class="token punctuation">:</span>/logs
      <span class="token punctuation">-</span> /root/mysql/data<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ems
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> redis

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>4.0.14
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;6379:6379&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ems
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/redis/data<span class="token punctuation">:</span>/data
    <span class="token key atrule">command</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>server
    
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">ems</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_4-通过docker-compose运行一组容器"><a href="#_4-通过docker-compose运行一组容器" class="header-anchor">#</a> 4.通过docker-compose运行一组容器</h4> <ul><li>参考文档:https://docker_practice.gitee.io/zh-cn/compose/commands.html</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker-compose up    							//前台启动一组服务</span>
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker-compose up -d 							//后台启动一组服务</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr> <h3 id="docker-compose-模板文件"><a href="#docker-compose-模板文件" class="header-anchor">#</a> docker-compose 模板文件</h3> <p>模板文件是使用 <code>Compose</code> 的核心，涉及到的指令关键字也比较多。但大家不用担心，这里面大部分指令跟 <code>docker run</code> 相关参数的含义都是类似的。</p> <p>默认的模板文件名称为 <code>docker-compose.yml</code>，格式为 YAML 格式。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> examples/web
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;80:80&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/data&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意每个服务都必须通过 <code>image</code> 指令指定镜像或 <code>build</code> 指令（需要 Dockerfile）等来自动构建生成镜像。</p> <p>如果使用 <code>build</code> 指令，在 <code>Dockerfile</code> 中设置的选项(例如：<code>CMD</code>, <code>EXPOSE</code>, <code>VOLUME</code>, <code>ENV</code> 等) 将会自动被获取，无需在 <code>docker-compose.yml</code> 中重复设置。</p> <p>下面分别介绍各个指令的用法。</p> <h4 id="build"><a href="#build" class="header-anchor">#</a> <code>build</code></h4> <p>指定 <code>Dockerfile</code> 所在文件夹的路径（可以是绝对路径，或者相对 docker-compose.yml 文件的路径）。 <code>Compose</code> 将会利用它自动构建这个镜像，然后使用这个镜像。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>你也可以使用 <code>context</code> 指令指定 <code>Dockerfile</code> 所在文件夹的路径。</p> <p>使用 <code>dockerfile</code> 指令指定 <code>Dockerfile</code> 文件名。</p> <p>使用 <code>arg</code> 指令指定构建镜像时的变量。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="command"><a href="#command" class="header-anchor">#</a> <code>command</code></h4> <p>覆盖容器启动后默认执行的命令。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span> echo &quot;hello world&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="container-name"><a href="#container-name" class="header-anchor">#</a> <code>container_name</code></h4> <p>指定容器名称。默认将会使用 <code>项目名称_服务名称_序号</code> 这样的格式。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">container_name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>web<span class="token punctuation">-</span>container
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称。</p></blockquote> <h4 id="depends-on"><a href="#depends-on" class="header-anchor">#</a> <code>depends_on</code></h4> <p>解决容器的依赖、启动先后的问题。以下例子中会先启动 <code>redis</code> <code>db</code> 再启动 <code>web</code></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
      <span class="token punctuation">-</span> redis

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>注意：<code>web</code> 服务不会等待 <code>redis</code> <code>db</code> 「完全启动」之后才启动。</p></blockquote> <h4 id="env-file"><a href="#env-file" class="header-anchor">#</a> <code>env_file</code></h4> <p>从文件中获取环境变量，可以为单独的文件路径或列表。</p> <p>如果通过 <code>docker-compose -f FILE</code> 方式来指定 Compose 模板文件，则 <code>env_file</code> 中变量的路径会基于模板文件路径。</p> <p>如果有变量名称与 <code>environment</code> 指令冲突，则按照惯例，以后者为准。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>环境变量文件中每一行必须符合格式，支持 <code>#</code> 开头的注释行。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># common.env: Set development environment</span>
<span class="token assign-left variable">PROG_ENV</span><span class="token operator">=</span>development
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="environment"><a href="#environment" class="header-anchor">#</a> <code>environment</code></h4> <p>设置环境变量。你可以使用数组或字典两种格式。</p> <p>只给定名称的变量会自动获取运行 Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>

<span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RACK_ENV=development
  <span class="token punctuation">-</span> SESSION_SECRET
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果变量名称或者值中用到 <code>true|false，yes|no</code> 等表达 <a href="https://yaml.org/type/bool.html" target="_blank" rel="noopener noreferrer">布尔<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 含义的词汇，最好放到引号里，避免 YAML 自动解析某些内容为对应的布尔语义。这些特定词汇，包括</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>y<span class="token operator">|</span>Y<span class="token operator">|</span><span class="token function">yes</span><span class="token operator">|</span>Yes<span class="token operator">|</span>YES<span class="token operator">|</span>n<span class="token operator">|</span>N<span class="token operator">|</span>no<span class="token operator">|</span>No<span class="token operator">|</span>NO<span class="token operator">|</span><span class="token boolean">true</span><span class="token operator">|</span>True<span class="token operator">|</span>TRUE<span class="token operator">|</span><span class="token boolean">false</span><span class="token operator">|</span>False<span class="token operator">|</span>FALSE<span class="token operator">|</span>on<span class="token operator">|</span>On<span class="token operator">|</span>ON<span class="token operator">|</span>off<span class="token operator">|</span>Off<span class="token operator">|</span>OFF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="healthcheck"><a href="#healthcheck" class="header-anchor">#</a> <code>healthcheck</code></h4> <p>通过命令检查容器是否健康运行。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;curl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">interval</span><span class="token punctuation">:</span> 1m30s
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="image"><a href="#image" class="header-anchor">#</a> <code>image</code></h4> <p>指定为镜像名称或镜像 ID。如果镜像在本地不存在，<code>Compose</code> 将会尝试拉取这个镜像。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu
<span class="token key atrule">image</span><span class="token punctuation">:</span> orchardup/postgresql
<span class="token key atrule">image</span><span class="token punctuation">:</span> a4bc65fd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="networks"><a href="#networks" class="header-anchor">#</a> <code>networks</code></h4> <p>配置容器连接的网络。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network
     <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">some-network</span><span class="token punctuation">:</span>
  <span class="token key atrule">other-network</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="ports"><a href="#ports" class="header-anchor">#</a> <code>ports</code></h4> <p>暴露端口信息。</p> <p>使用宿主端口：容器端口 <code>(HOST:CONTAINER)</code> 格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">ports</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;3000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;8000:8000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;49100:22&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;127.0.0.1:8001:8001&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><em>注意：当使用 <code>HOST:CONTAINER</code> 格式来映射端口时，如果你使用的容器端口小于 60 并且没放到引号里，可能会得到错误结果，因为 <code>YAML</code> 会自动解析 <code>xx:yy</code> 这种数字格式为 60 进制。为避免出现这种问题，建议数字串都采用引号包括起来的字符串格式。</em></p> <h4 id="sysctls"><a href="#sysctls" class="header-anchor">#</a> <code>sysctls</code></h4> <p>配置容器内核参数。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token key atrule">net.core.somaxconn</span><span class="token punctuation">:</span> <span class="token number">1024</span>
  <span class="token key atrule">net.ipv4.tcp_syncookies</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> net.core.somaxconn=1024
  <span class="token punctuation">-</span> net.ipv4.tcp_syncookies=0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="ulimits"><a href="#ulimits" class="header-anchor">#</a> <code>ulimits</code></h4> <p>指定容器的 ulimits 限制值。</p> <p>例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制） 和 40000（系统硬限制，只能 root 用户提高）。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">ulimits</span><span class="token punctuation">:</span>
    <span class="token key atrule">nproc</span><span class="token punctuation">:</span> <span class="token number">65535</span>
    <span class="token key atrule">nofile</span><span class="token punctuation">:</span>
      <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">20000</span>
      <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">40000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="volumes"><a href="#volumes" class="header-anchor">#</a> <code>volumes</code></h4> <p>数据卷所挂载路径设置。可以设置为宿主机路径(<code>HOST:CONTAINER</code>)或者数据卷名称(<code>VOLUME:CONTAINER</code>)，并且可以设置访问模式 （<code>HOST:CONTAINER:ro</code>）。</p> <p>该指令中路径支持相对路径。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> /var/lib/mysql
 <span class="token punctuation">-</span> cache/<span class="token punctuation">:</span>/tmp/cache
 <span class="token punctuation">-</span> ~/configs<span class="token punctuation">:</span>/etc/configs/<span class="token punctuation">:</span>ro
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果路径为数据卷名称，必须在文件中配置数据卷。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_src</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql_data</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr> <h3 id="docker-compose-常用命令"><a href="#docker-compose-常用命令" class="header-anchor">#</a> docker-compose 常用命令</h3> <h5 id="_1-命令对象与格式"><a href="#_1-命令对象与格式" class="header-anchor">#</a> 1. 命令对象与格式</h5> <p>对于 Compose 来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或者容器。如果没有特别的说明，命令对象将是项目，这意味着项目中所有的服务都会受到命令影响。</p> <p>执行 <code>docker-compose [COMMAND] --help</code> 或者 <code>docker-compose help [COMMAND]</code> 可以查看具体某个命令的使用格式。</p> <p><code>docker-compose</code> 命令的基本的使用格式是</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> <span class="token punctuation">[</span>-f<span class="token operator">=</span><span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARGS<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2-命令选项"><a href="#_2-命令选项" class="header-anchor">#</a> 2. 命令选项</h5> <ul><li><code>-f, --file FILE</code> 指定使用的 Compose 模板文件，默认为 <code>docker-compose.yml</code>，可以多次指定。</li> <li><code>-p, --project-name NAME</code> 指定项目名称，默认将使用所在目录名称作为项目名。</li> <li><code>--x-networking</code> 使用 Docker 的可拔插网络后端特性</li> <li><code>--x-network-driver DRIVER</code> 指定网络后端的驱动，默认为 <code>bridge</code></li> <li><code>--verbose</code> 输出更多调试信息。</li> <li><code>-v, --version</code> 打印版本并退出。</li></ul> <h5 id="_3-命令使用说明"><a href="#_3-命令使用说明" class="header-anchor">#</a> 3.命令使用说明</h5> <h5 id="up"><a href="#up" class="header-anchor">#</a> <code>up</code></h5> <p>格式为 <code>docker-compose up [options] [SERVICE...]</code>。</p> <ul><li><p>该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。</p></li> <li><p>链接的服务都将会被自动启动，除非已经处于运行状态。</p></li> <li><p>可以说，大部分时候都可以直接通过该命令来启动一个项目。</p></li> <li><p>默认情况，<code>docker-compose up</code> 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。</p></li> <li><p>当通过 <code>Ctrl-C</code> 停止命令时，所有容器将会停止。</p></li> <li><p>如果使用 <code>docker-compose up -d</code>，将会在后台启动并运行所有的容器。一般推荐生产环境下使用该选项。</p></li> <li><p>默认情况，如果服务容器已经存在，<code>docker-compose up</code> 将会尝试停止容器，然后重新创建（保持使用 <code>volumes-from</code> 挂载的卷），以保证新启动的服务匹配 <code>docker-compose.yml</code> 文件的最新内容</p></li></ul> <hr> <h5 id="down"><a href="#down" class="header-anchor">#</a> <code>down</code></h5> <ul><li>此命令将会停止 <code>up</code> 命令所启动的容器，并移除网络</li></ul> <hr> <h5 id="exec"><a href="#exec" class="header-anchor">#</a> <code>exec</code></h5> <ul><li>进入指定的容器。</li></ul> <hr> <h5 id="ps"><a href="#ps" class="header-anchor">#</a> <code>ps</code></h5> <p>格式为 <code>docker-compose ps [options] [SERVICE...]</code>。</p> <p>列出项目中目前的所有容器。</p> <p>选项：</p> <ul><li><code>-q</code> 只打印容器的 ID 信息。</li></ul> <hr> <h5 id="restart"><a href="#restart" class="header-anchor">#</a> <code>restart</code></h5> <p>格式为 <code>docker-compose restart [options] [SERVICE...]</code>。</p> <p>重启项目中的服务。</p> <p>选项：</p> <ul><li><code>-t, --timeout TIMEOUT</code> 指定重启前停止容器的超时（默认为 10 秒）。</li></ul> <hr> <h5 id="rm"><a href="#rm" class="header-anchor">#</a> <code>rm</code></h5> <p>格式为 <code>docker-compose rm [options] [SERVICE...]</code>。</p> <p>删除所有（停止状态的）服务容器。推荐先执行 <code>docker-compose stop</code> 命令来停止容器。</p> <p>选项：</p> <ul><li><code>-f, --force</code> 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。</li> <li><code>-v</code> 删除容器所挂载的数据卷。</li></ul> <hr> <h5 id="start"><a href="#start" class="header-anchor">#</a> <code>start</code></h5> <p>格式为 <code>docker-compose start [SERVICE...]</code>。</p> <p>启动已经存在的服务容器。</p> <hr> <h5 id="stop"><a href="#stop" class="header-anchor">#</a> <code>stop</code></h5> <p>格式为 <code>docker-compose stop [options] [SERVICE...]</code>。</p> <p>停止已经处于运行状态的容器，但不删除它。通过 <code>docker-compose start</code> 可以再次启动这些容器。</p> <p>选项：</p> <ul><li><code>-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</li></ul> <hr> <h5 id="top"><a href="#top" class="header-anchor">#</a> <code>top</code></h5> <p>查看各个服务容器内运行的进程。</p> <hr> <h5 id="unpause"><a href="#unpause" class="header-anchor">#</a> <code>unpause</code></h5> <p>格式为 <code>docker-compose unpause [SERVICE...]</code>。</p> <p>恢复处于暂停状态中的服务。</p> <hr> <h2 id="docker可视化工具"><a href="#docker可视化工具" class="header-anchor">#</a> docker可视化工具</h2> <h4 id="安装portainer"><a href="#安装portainer" class="header-anchor">#</a> 安装Portainer</h4> <p>官方安装说明：<a href="http://www.yunweipai.com/go?_=8fe4813824aHR0cHM6Ly93d3cucG9ydGFpbmVyLmlvL2luc3RhbGxhdGlvbi8=" target="_blank" rel="noopener noreferrer">https://www.portainer.io/installation/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker pull  portainer/portainer</span>

<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker volume create portainer_data</span>
portainer_data
<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</span>
20db26b67b791648c2ef6aee444a5226a9c897ebcf0160050e722dbf4a4906e3
<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker ps </span>
CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                                            NAMES
20db26b67b79        portainer/portainer   <span class="token string">&quot;/portainer&quot;</span>        <span class="token number">5</span> seconds ago       Up <span class="token number">4</span> seconds        <span class="token number">0.0</span>.0.0:8000-<span class="token operator">&gt;</span><span class="token number">8000</span>/tcp, <span class="token number">0.0</span>.0.0:9000-<span class="token operator">&gt;</span><span class="token number">9000</span>/tcp   portainer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="登录和使用portainer"><a href="#登录和使用portainer" class="header-anchor">#</a> 登录和使用Portainer</h4> <blockquote><p>用浏览器访问：<code>http://localhost:9000</code></p></blockquote> <p><img src="https://wiki-1251603812.cos.ap-shanghai.myqcloud.com/images/image-20220501142933527.png" alt="image-20220501142933527"></p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=K8S" title="标签">#K8S</a><a href="/tags/?tag=Docker" title="标签">#Docker</a><a href="/tags/?tag=DockerCompose" title="标签">#DockerCompose</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/01, 06:34:13</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/dev/java/core/springbootbase/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Springboot1 基础篇</div></a> <a href="/dev/java/eco/springsecurity/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Spring Security</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dev/java/core/springbootbase/" class="prev">Springboot1 基础篇</a></span> <span class="next"><a href="/dev/java/eco/springsecurity/">Spring Security</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/sec/vuln/deserialization/serialization/"><div>
            反序列化漏洞原理 - 反序列化
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">05-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/more/blog/privatepage/"><div>
            私密文章测试
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/dev/basic/ds/list/"><div>
            【数据结构】线性表
            <!----></div></a> <span class="date">05-06</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:p0josec@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/p0josec" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Vuepress-theme-Vdoing | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div></div></div></div>
    <script src="/assets/js/app.cc096181.js" defer></script><script src="/assets/js/2.5dee0ed7.js" defer></script><script src="/assets/js/27.833d6eeb.js" defer></script>
  </body>
</html>
